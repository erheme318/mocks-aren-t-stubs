# Ялгаануудаас сонгох

Энэ нийтлэлд би дараах хос ялгаануудын талаар тайлбарласан: төлвөөр (state) эсвэл үйлдлээр батлах / сонгодог эсвэл дууриамал тестийн аргаар хөгжүүлэх ТDD. Дээрх аргуудын нэгийг сонгохдоо ямар зарчмуудыг баримтлах хэрэгтэй вэ ? Эхлээд үйлдлээр батлахын эсрэг төлвөөр батлах аргыг авч үзье.

Эхний авч үзэх шаардлагатай зүйл нь аргуулга (context) юм. Бидний ажиллаж объект хоорондын харилцаа (collaboration) *захиалга* (order) болон *агуулах* (warehouse) шиг хялбархан байна уу эсвэл *захиалга* (order) болон *mail service* шиг төвөгтэй байна уу ?

Хэрэв хоорондын харилцаа нь хялбархан бол сонголт хийхэд амархан. Хэрэв би сонгодог TDD аргаар хөгжүүлэгч бол би ямар нэгэн *дууриамал объект* (*mock*), *stub*, *double*-уудыг ашиглахгүй. Би жинхэнэ объектууд болон төлвөөр батлах аргыг ашиглана. Хэрэв би дууриамал TDD аргаар хөгжүүлэгч бол дууриамал объектууд болон үйлдлээр батлах аргуудыг ашиглана. Ямар ч шийдвэр гаргах шаардлагүй.

Хэрэв хоорондын харилцаа нь төвөгтэй бөгөөд би дууриамал TDD аргаар хөгжүүлэгч бол ямар ч асуудалгүй би дууриамал объектууд болон үйлдлээр батлах аргыг ашиглана. Харин би сонгодог аргааг хөгжүүлэгч бол надаа сонголт бий. Хэдий тийм ч альнийг нь сонгох нь тийм ч чухал биш. Ихэвчлэн сонгодог аргаар хөгжүүлэгчид тухайн байдлаасаа болоод аль амрыг нь сонгодог.

Бид төлвөөр эсвэл үйлдлээр батлах сонголтыг хийхэд тийм ч хүндрэлтэй биш гэдгийг харлаа. Гол асуудал нь сонгодог TDD юу эсвэл дууриамал TDD юу гэсэн сонголт юм. Төлвөөр батлах болон үйлдлээр батлах аргуудын зарчмууд энэхүү хэлэлцүүлэгт нөлөөлөх нь зайлшгүй бөгөөд үүнд би онцгой анхаарах болно.

Эхлэхээсээ өмнө би нэг хязгаарын нөхцөлийг дурьдахгүй бол болохгүй нь. Зарим үед объект хооронд харилцаа хялбар байсан ч төлвөөр батлах аргыг ашиглахад нилээд төвөгтэй байдаг. Үүний нэг сонгодог жишээ нь *cache* юм. Үүний нэг гол зүйл нь *cache* -ын тухайн төлвөөс та *cache hit* болсон уу *cache missed* болсныг хэлж чадахгүй. Энэ нөхцөлд хэдийгээр та үнэнч сонгодог TDD аргыг баримтлагч байсан ч үйлдлээр батлах аргыг сонгосон нь дээр болохыг ойлгоно. Үүнтэй ижил мөн өөр төрлийн хязгаарын нөхцлүүд аль ч аргад нь байгаа гэдэгт би эргэлзэхгүй байна.

Сонгодог уу, эсвэл дууриамал аргаар хөгжүүлэгч үү гэсэн сонголтыг хийхэд бид нилээд хэдэн хүчин зүйлүүдийг авч үзэх шаардлагатай болохоор би дараах байдлаар тойм хэдэн бүлгүүдэд хуваасан болно.

## TDD -р хөтлөгдөх

Дууриамал объект бол XP -ийн бүлгээс гаралтай ба XP-ын гол онцлогуудын нэг нь Тестээр Хөтлөгдөх Хөгжүүлэлт (Test Driven Development) -ийн аргыг чухалчилдаг билээ. Үүнд системийн загварын хувьсал, өөрчлөлтүүд нь бичигдэх тестээр хөтлөгдөн давталттайгаар хийгддэг.

Тиймээс дууриамал тестийн аргаар хөгжүүлэгчид тухайн арга системийн загварт хэрхэн нөлөөлдөг талаар тусгайлан авч үздгийг гайхах зүйлгүй юм. Ялангуяа тэд Need-driven development (шаардлагаас хөтлөгдөх хөгжүүлэлт) гэх аргыг дэмждэг. Энэ аргаар бол та [user story](http://martinfowler.com/bliki/UserStory.html) (хэрэглэгчийн шаардлага, хэрэглэгдэх байдал) -ыг хөгжүүлэхдээ эхлээд системийн хамгийн гадна талаас нь тестлэх байдлаар эхэлж, SUT -ынхаа интерфайсыг тодорхойлдог. Хамтрагч объектуудын хийгдэх үйлдлүүдийг нь олохдоо, SUT болон түүний хөрш объектуудыг хоорондын харилцааг судлан SUT-н outbound interface (хөрш объекттой харилцах гаралтын интерфэйс) -ыг тодорхойлдог.

Хамгийн эхний тест тань ажиллаж байгаа үед дууриамал объект дээр тодорхойлогдсон expectations (тэгнэ гэсэн хүлээлт)-үүд таны дараагын алхам дахь шаардлага болон хувчирч, тестлэх эхний алхам болдог. Ингэж expectation (тэгнэ гэсэн хүлээлт) бүрийг хамтрагч объектын тест болон хувиргах үйлдлийг систем рүү нэвтрэх давхрага SUT бүрт давтана. Энэ загварын аргыг мөн *outside-in* гэж нэрлэдэг ба энэ нь нилээд оновчтой тодорхойлсон нэр. Энэ загварчлалын арга layered system (давхарга систем) -д нилээд сайн таарч ажилладаг. Та эхлээд UI (хэрэглэгчийн интерфэйс)-ыг програмчилах ба түүний доор давхаргуудыг дууриамилаар тодорхойлно. Ингэсний дараа та доорх давхарга нэг бүрт тест бичин аажмаар системийн давхарга бүрт нэвтрэн доошлоно. Энэ загварын арга бол маш зохион байгуулалтайгаар удирдагдах арга тул олон хүмүүс ООП (OOP) болон TDD -г анхлагч суралцагчдад ихээхэн хэрэгтэй гэж итгэдэг.

Сонгодог TDD арга үүнтэй зааварчилгаа өгдөггүй. Хэдийгээр тийм ч та mock-ын оронд stub-ыг ашиглан ижил төрлийн алхамаар загварчлах боломжтой. Ингэхийн тулд, SUT-г ажиллуулах тестэнд хамтрагч объектоос ямар нэгэн зүйл хэрэг болох бүртээ уг утгыг hard-code байдлаар бичнэ. Ингээд та тест ногоон болсон үедээ hard-coded утгаа зөв кодоор сольно.

Сонгодог тестийн арга өөр бас онцлогтой. Нэг арга нь *middle-out*. Энэ аргад та шинээр хийгдэх feature-аа сонгоод, тухайн feature ажиллахад домайн-с юу хэрэг болох талаар бодож, шийдвэр гаргана. Ингээд домайн объектууд юу хийгдэх ёстойг загварчилсныхаа дараа  
UI давхаргыг дээрээс нь тавьж ажиллуулна. Ингэж ажиллахад таньд магадгүй ямар ч дууриамал зүйл хэрэг болохгүй байх. Маш олон хүмүүс энэ аргад дуртай байдаг учир нь энэ арга хүний анхаарлыг эхлээд домайны загварчлал (domain model) -д төвлөрүүлдэг ба энэ нь домайны логикууд UI-аас хамаарахгүй байх боломжыг ойлгодог.

Миний нэг онцолж хэлэх зүйл гэвэл сонгодог болон дууриамал загварчлалын аргаар хөгжүүлэгч бүр тухайн нэг зүйлийг тухайн цагт хийдэг (do one at a time).
Энэ нь программын давхрага бүрийг нэг нэгээр нь дараалан гүйцэтгэх зарчим ба нэг давхаргыг дуусгахаасаа өмнө хэзээ ч нөгөө нь эхлүүлэхгүй гэсэн бүр *school of thought* (цэгцтэй, мөрдөж дагадаг зарчмууд) байдаг. Сонгодог болон дууриамал загварчлалаар хөгжүүлэгчид хоёул *Agile* аргачлал дээр суурьтай байдаг тул нарийн тусгаарлагдсан давталтайгаар (fine-grained iterations) хөгжүүлэхийг илүүд үздэг. Тиймээс тэд давхрага давхрагаар хөгжүүлэхээс илүүтэйгээр feature-үүдийг нэг нэгээр (feature by feature) нь авч ажиллахыг илүүд үздэг.














