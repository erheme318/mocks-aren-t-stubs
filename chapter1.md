## Ердийн тестүүд

Хоёр төрлийн аргыг энгийн жишээгээр тайлбарлаж эхэлье. (Жишээнүүд Жава хэл дээр бичигдсэн болохоос зарчмууд нь бусад бүх объект хандалтад програмчлалын хэл дээр ялгаагүй боломжтой.) Бидэнд Захиалга (Order) объект байгаа бөгөөд түүнийг Агуулах (Warehouse) объектоос дүүргэлт хийгддэг гэж үзье. Захиалга (Order) объект маш энгийн энгийн зөвхөн бараа (product) болон бүтээгдэхүүний тоо (quantity) хоёроос бүрддэг. Харин Агуулах (Warehouse) объект олон төрлийн бараануудын тооллого бүртгэлийг (inventory) агуулна. Бид Захиалга объектыг Агуулах -с өөрийгөө дүүргэ гэж хэлэх юм бол, бидэнд хоёр төрлийн хариулт өгөх боломжтой. Хэрэв агуулахад (Warehouse) байгаа бараа захиалга (Order) хийгдэхэд хангалттай бол, захиалга хийгдэж, агуулахын барааны дүн захиалсан барааны тоогоор буурна. Хэрэв агуулахад хангалттай бараа байхгүй бол, захиалга хийгдэхгүй ба агуулахад ямар ч өөрчлөлт орохгүй.

Эдгээр хоёр үйлдлүүд нилээдгүй хэдэн тестүүд дээр хийгдэх ба эдгээр нь доорх ердийн JUnit тестүүдтэй төстэй байх болов уу.

```java
public class OrderStateTester extends TestCase {
  private static String TALISKER = "Talisker";
  private static String HIGHLAND_PARK = "Highland Park";
  private Warehouse warehouse = new WarehouseImpl();

  protected void setUp() throws Exception {
    warehouse.add(TALISKER, 50);
    warehouse.add(HIGHLAND_PARK, 25);
  }
  public void testOrderIsFilledIfEnoughInWarehouse() {
    Order order = new Order(TALISKER, 50);
    order.fill(warehouse);
    assertTrue(order.isFilled());
    assertEquals(0, warehouse.getInventory(TALISKER));
  }
  public void testOrderDoesNotRemoveIfNotEnough() {
    Order order = new Order(TALISKER, 51);
    order.fill(warehouse);
    assertFalse(order.isFilled());
    assertEquals(50, warehouse.getInventory(TALISKER));
  }
```
  
xUnit тестүүд дараах дөрвөн төрлийн үе шатыг (phase) хийж гүйцэтгэдэг: setup, exercise, verify, teardown. Дээрх кодонд setup үе шат нь хагас нь setUp метод-д (Агуулах - warehouse -  объектыг байгуулахад), үлдсэн тал нь тест метод дотор (захиалга - order -  объектыг байгуулахад) хийгдсэн байна. order.fill гэж дуудаж байгаа нь exercise үе шат. Энэ үед бидний теслэх гээд хүсээд байгаа зүйлсийг маань объект гүйцэтгэх ёстой. assert (нотлох) шалгалтын зааврууд бол verification үе шат. Энд хэрэгжүүлсэн (exercised) метод шаардлагатай даалгаруудыг зөв гүйцэтгэсэн эсэхийг шалгана. Дээрх жишээн дээр tearDown үе шат яг тодорхой илэрхийлэгдээгүй ба garbage collector тэдгээрийг бидний өмнөөс нүдэнд харагдахгүй байдлаар хийж гүйцэтгэж байгаа.

setup үед бид 2 төрлийн объектыг үүсгэж байгаа. Order бол бидний тестлэж буй класс харин Order.fill -ыг ажиллуулахын тулд бидэнд Warehouse объект мөн хэрэг болж байгаа. Дээрхд дахин тодруулах нэг зүйл гэвэл: Order объект бол бидний тестлэх гэж анхаарлаа хандуулаад байгаа объект юм. Тестээр дагнаж мэргэшсэн хүмүүс үүнийг object-under-test, system-under-test гэх мэтээр нэрлэдэг. Хоёул хэлэхэд төвөгтэй, онцгүй нэрнүүд, хэдийгээр тийм ч олонд энэ чигээрээ илүү танигдсан нэршлүүд тул би мөн энэ чигээр нь ашиглаад явъя. Meszaros -н дагуу би System Under Test юмуу эсвэл бүүр товчлоод SUT гэх байдлаар тэмдэглээд явна.

Дээрх тестэнд надад нэг SUT (Order), нэг хамтрагч - collaborator - (warehouse) хэрэг болно. Хоёр шалтгааны улмаас надаа warehouse хэрэг болж байгаа: эхнийх нь тестлэгдэж буй бүхий л үйлдлүүдыг ямар ч асуудалгүйгээр ажиллуулахын тулд (Order.fill метод warehouse-ын методуудыг дуудаж буйгаа тул), хоёр дугаарт төлвийн баталгааг хийхийн тулд (Order.fill -с гарах аль нэг үр дүн warehouse -ын төлвийг өөрчлөх боломжтой учираас). Бид цаашид энэ сэдвийн талаар илүү судлаад, SUT болон хамтрагчуудын (collaborators) хоорондын олон зөрүүтэй ялгаа гаргаад ирэхээр та илүү олгох болно. (Өмнө нь би SUT -ыг “гол объект”, хамтрагчуудыг “хоёрдогч объект” гэх мэтээр нэрлэдэг байсан)

Энэхүү тестийн загвар нь төлөв батлах (state verification) арга юм. Юу гэсэн үг вэ гэхээр метод дуудагдаж, гүйцэтгэгдсэний дараа SUT болон хамтрагч нарын төлвийг шалгаж тэдгээр шалгагдаж буй методууд зөв ажилласан эсэхийг тодорхойлно. Дууриамал (Mock) объект шалгалтын өөр нэг боломжийг олгодогыг бид удахгүй харна болно.